<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="BRCindicators">
<title>BRCindicators • BRCindicators</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="BRCindicators">
<meta property="og:description" content="BRCindicators">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BRCindicators</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.7</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette.html">BRCindicators</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/BiologicalRecordsCentre/BRCindicators/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>BRCindicators</h1>
                        <h4 data-toc-skip class="author">Tom August</h4>
            
            <h4 data-toc-skip class="date">10 June, 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BiologicalRecordsCentre/BRCindicators/blob/HEAD/vignettes/vignette.Rmd" class="external-link"><code>vignettes/vignette.Rmd</code></a></small>
      <div class="d-none name"><code>vignette.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">snowfall</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document shows how to use the indicator pipeline to create
biodiversity indicators such as those for DEFRA’s <a href="http://jncc.defra.gov.uk/page-1824" class="external-link">Biodiversity Indicators in
Your Pocket</a>. The pipeline is shared in the form of an R package
called ‘BRCindicators’ making it easy to share and maintain.</p>
<p>The functions in BRCindicators work with yearly estimates of species
abundance or occurrence and aggregate them into an scaled indicator
value with bootstrapped confidence intervals</p>
<p>This package has the ability to read in the output of occupancy
models created in the R package sparta, a package for estimating species
trends from occurrence data. This package can be installed <a href="https://github.com/BiologicalRecordsCentre/sparta" class="external-link">from Github</a>
and details of how to use the package are given in <a href="https://github.com/BiologicalRecordsCentre/sparta/raw/master/vignette/sparta_vignette.pdf" class="external-link">the
package vignette</a>. There is no need to use sparta to create your
yearly species estimates as BRCindicators can also work with other
data.</p>
<p>To create an indicator we first need to have species trends, let’s
create some using the sparta R package.</p>
</div>
<div class="section level2">
<h2 id="creating-yearly-estimates-of-occurrence-in-sparta">Creating yearly estimates of occurrence in sparta<a class="anchor" aria-label="anchor" href="#creating-yearly-estimates-of-occurrence-in-sparta"></a>
</h2>
<p>If you already have yearly estimates of abundance or occurrence for
your species you can skip this stage. Here we show how you can create
these estimates from raw species observation data using sparta.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install BRCindicators from github</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="co">#install_github('biologicalrecordscentre/sparta')</span></span></code></pre></div>
<p>Let’s assume you have some raw data already, we can under take
occupancy modelling like this</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create data</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">8000</span> <span class="co"># size of dataset</span></span>
<span><span class="va">nyr</span> <span class="op">&lt;-</span> <span class="fl">50</span> <span class="co"># number of years in data</span></span>
<span><span class="va">nSamples</span> <span class="op">&lt;-</span> <span class="fl">200</span> <span class="co"># set number of dates</span></span>
<span><span class="va">nSites</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># set number of sites</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">125</span><span class="op">)</span> <span class="co"># set a random seed</span></span>
<span></span>
<span><span class="co"># Create somes dates</span></span>
<span><span class="va">first</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strptime.html" class="external-link">strptime</a></span><span class="op">(</span><span class="st">"1950/01/01"</span>, <span class="st">"%Y/%m/%d"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">last</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strptime.html" class="external-link">strptime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fl">1950</span><span class="op">+</span><span class="op">(</span><span class="va">nyr</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="st">"/12/31"</span>, sep<span class="op">=</span><span class="st">''</span><span class="op">)</span>, <span class="st">"%Y/%m/%d"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="va">last</span><span class="op">-</span><span class="va">first</span> </span>
<span><span class="va">rDates</span> <span class="op">&lt;-</span> <span class="va">first</span> <span class="op">+</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nSamples</span><span class="op">)</span><span class="op">*</span><span class="va">dt</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># taxa are set semi-randomly</span></span>
<span><span class="va">taxa_probabilities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.1</span>, to <span class="op">=</span> <span class="fl">0.7</span>, length.out <span class="op">=</span> <span class="fl">26</span><span class="op">)</span></span>
<span><span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">letters</span>, size <span class="op">=</span> <span class="va">n</span>, <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="va">taxa_probabilities</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sites are visited semi-randomly</span></span>
<span><span class="va">site_probabilities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.1</span>, to <span class="op">=</span> <span class="fl">0.7</span>, length.out <span class="op">=</span> <span class="va">nSites</span><span class="op">)</span></span>
<span><span class="va">site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nSites</span>, sep<span class="op">=</span><span class="st">''</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">n</span>, <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="va">site_probabilities</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the date of visit is selected semi-randomly from those created earlier</span></span>
<span><span class="va">time_probabilities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.1</span>, to <span class="op">=</span> <span class="fl">0.7</span>, length.out <span class="op">=</span> <span class="va">nSamples</span><span class="op">)</span></span>
<span><span class="va">time_period</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">rDates</span>, size <span class="op">=</span> <span class="va">n</span>, <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="va">time_probabilities</span><span class="op">)</span></span>
<span></span>
<span><span class="va">myData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">taxa</span>, <span class="va">site</span>, <span class="va">time_period</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the sparta package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BiologicalRecordsCentre/sparta" class="external-link">sparta</a></span><span class="op">)</span></span></code></pre></div>
<p>For demonstration purposes I have a faked dataset of 8000 species
observations. In my dataset the species are named after the letters in
the alphabet. Below I show how I can use the Bayesian occupancy models
in sparta to create yearly estimates of occurrence. For more information
please see the <a href="https://github.com/BiologicalRecordsCentre/sparta/raw/master/vignette/sparta_vignette.pdf" class="external-link">vignette
for sparta</a></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Preview of my data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">myData</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   taxa site time_period</span></span>
<span><span class="co">## 1    r  A51  1970-01-14</span></span>
<span><span class="co">## 2    v  A87  1980-09-29</span></span>
<span><span class="co">## 3    e  A56  1996-04-14</span></span>
<span><span class="co">## 4    z  A28  1959-01-16</span></span>
<span><span class="co">## 5    r  A77  1970-09-21</span></span>
<span><span class="co">## 6    x  A48  1990-02-25</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First format our data</span></span>
<span><span class="va">formattedOccData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sparta/man/formatOccData.html" class="external-link">formatOccData</a></span><span class="op">(</span>taxa <span class="op">=</span> <span class="va">myData</span><span class="op">$</span><span class="va">taxa</span>,</span>
<span>                                  site <span class="op">=</span> <span class="va">myData</span><span class="op">$</span><span class="va">site</span>,</span>
<span>                                  survey <span class="op">=</span> <span class="va">myData</span><span class="op">$</span><span class="va">time_period</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in errorChecks(taxa = taxa, site = site, survey = survey, replicate =</span></span>
<span><span class="co">## replicate, : 94 out of 8000 observations will be removed as duplicates</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here we are going to use the package snowfall to parallelise</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">snowfall</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># I have 4 cpus on my PC so I set cpus to 4</span></span>
<span><span class="co"># when I initialise the cluster</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/snowfall/man/snowfall-b-init.html" class="external-link">sfInit</a></span><span class="op">(</span>parallel <span class="op">=</span> <span class="cn">TRUE</span>, cpus <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R Version:  R version 4.4.0 (2024-04-24 ucrt)</span></span></code></pre>
<pre><code><span><span class="co">## snowfall 1.84-6.3 initialized (using snow 0.4-4): parallel execution on 4 CPUs.</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Export my data to the cluster</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/snowfall/man/snowfall-d-tools.html" class="external-link">sfExport</a></span><span class="op">(</span><span class="st">'formattedOccData'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># I create a function that takes a species name and runs my model</span></span>
<span><span class="va">occ_mod_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">taxa_name</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BiologicalRecordsCentre/sparta" class="external-link">sparta</a></span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Note that this will write you results to your computer</span></span>
<span>  <span class="co"># the location is set to your user folder</span></span>
<span>  <span class="va">occ_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sparta/man/occDetFunc.html" class="external-link">occDetFunc</a></span><span class="op">(</span>taxa_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">taxa_name</span><span class="op">)</span>,</span>
<span>                        n_iterations <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                        burnin <span class="op">=</span> <span class="fl">15</span>, </span>
<span>                        occDetdata <span class="op">=</span> <span class="va">formattedOccData</span><span class="op">$</span><span class="va">occDetdata</span>,</span>
<span>                        spp_vis <span class="op">=</span> <span class="va">formattedOccData</span><span class="op">$</span><span class="va">spp_vis</span>,</span>
<span>                        write_results <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        output_dir <span class="op">=</span> <span class="st">'~/Testing_indicator_pipe'</span>,</span>
<span>                        seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span>  </span>
<span><span class="op">}</span> </span>
<span><span class="co"># I then run this in parallel</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span><span class="va">para_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/snowfall/man/snowfall-c-calculation.html" class="external-link">sfClusterApplyLB</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">myData</span><span class="op">$</span><span class="va">taxa</span><span class="op">)</span>, <span class="va">occ_mod_function</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##    0.06    0.07  162.00</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Stop the cluster</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/snowfall/man/snowfall-b-init.html" class="external-link">sfStop</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Stopping cluster</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can see all the files this has created</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">'~/Testing_indicator_pipe'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "a.rdata" "b.rdata" "c.rdata" "d.rdata" "e.rdata" "f.rdata" "g.rdata"</span></span>
<span><span class="co">##  [8] "h.rdata" "i.rdata" "j.rdata" "k.rdata" "l.rdata" "m.rdata" "n.rdata"</span></span>
<span><span class="co">## [15] "o.rdata" "p.rdata" "q.rdata" "r.rdata" "s.rdata" "t.rdata" "u.rdata"</span></span>
<span><span class="co">## [22] "v.rdata" "w.rdata" "x.rdata" "y.rdata" "z.rdata"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="installing-brcindicators">Installing BRCindicators<a class="anchor" aria-label="anchor" href="#installing-brcindicators"></a>
</h2>
<p>Installing the package is easy and can be done in a couple of
lines</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'biologicalrecordscentre/BRCindicators'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summarising-sparta-output-for-an-indicator">Summarising sparta output for an indicator<a class="anchor" aria-label="anchor" href="#summarising-sparta-output-for-an-indicator"></a>
</h2>
<p>Now that we have some species trends data to work with (no doubt you
already have your own) we can use the first function in BRCindicators.
This function reads in all the output files from sparta (which are quite
large and complex) and returns a simple summary table that we can use
for calculating the indicator. If you have done your analysis without
using sparta you can skip to the next step.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BiologicalRecordsCentre/BRCindicators" class="external-link">BRCindicators</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># All we have to supply is the directory where out data is saved</span></span>
<span><span class="co"># You will note this is the 'output_dir' passed to sparta above.</span></span>
<span><span class="va">trends_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarise_occDet.html">summarise_occDet</a></span><span class="op">(</span>input_dir <span class="op">=</span> <span class="st">'~/Testing_indicator_pipe'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading data...done</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Lets see the summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trends_summary</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      year          a         b         c         d</span></span>
<span><span class="co">## [1,] 1950 0.71950820 0.7444262 0.5445902 0.7289617</span></span>
<span><span class="co">## [2,] 1951 0.64792350 0.7115847 0.6653552 0.5564481</span></span>
<span><span class="co">## [3,] 1952 0.61234973 0.6830055 0.2850820 0.5503279</span></span>
<span><span class="co">## [4,] 1953 0.47890710 0.4786339 0.5400546 0.6146448</span></span>
<span><span class="co">## [5,] 1954 0.40245902 0.5300546 0.6093443 0.4449180</span></span>
<span><span class="co">## [6,] 1955 0.04765027 0.4463934 0.6180874 0.3305464</span></span></code></pre>
<p>Returned from this function is a summary of the data as a matrix. In
each row we have the year, specified in the first column, and each
subsequent column is a species. The values in the table are the mean of
the posterior for the predicted proportion of sites occupied, a measure
of occurrence.</p>
</div>
<div class="section level2">
<h2 id="calculating-indicator-values">Calculating indicator values<a class="anchor" aria-label="anchor" href="#calculating-indicator-values"></a>
</h2>
<p>Once we have species-year indicies we are in a position to proceed to
calculating an indictor. To do this there are a number of mehods
available, some of which are presented here in ‘BRCindicators’</p>
<div class="section level3">
<h3 id="geometric-mean">Geometric mean<a class="anchor" aria-label="anchor" href="#geometric-mean"></a>
</h3>
<p>The geometric mean method is often used with data that do not have
errors associated with them.</p>
<p>The first step is to re-scale the data so that the value for all
species in the first year is the same. Once this is done we calculate
the geometric mean across species for each year creating the indicator
value. This function also accounts for species that have no data at the
beginning of the dataset by entering them at the geometric mean for that
year, this stops them dramatically changing the indicator value in the
year they join the dataset. It also accounts for species that leave the
dataset before the end by holding them at their last value. Finally
limits to species values can be given, preventing extremely high or low
values biasing the indicator.</p>
<div class="section level4">
<h4 id="rescaling-and-calculating-geometric-mean">Rescaling and calculating geometric mean<a class="anchor" aria-label="anchor" href="#rescaling-and-calculating-geometric-mean"></a>
</h4>
<p>The data I have generated in ‘trends_summary’ is very easy to work
with but to show off what this function can do I’m going to mess it up a
bit.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trends_summary</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="st">'a'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">trends_summary</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">'b'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">trends_summary</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, <span class="st">'c'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">trends_summary</span><span class="op">[</span><span class="fl">45</span><span class="op">:</span><span class="fl">50</span>, <span class="st">'d'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># Let's have a look at these changes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trends_summary</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      year          a         b            c         d</span></span>
<span><span class="co">## [1,] 1950         NA        NA    0.5445902 0.7289617</span></span>
<span><span class="co">## [2,] 1951         NA        NA 1000.0000000 0.5564481</span></span>
<span><span class="co">## [3,] 1952         NA        NA 1000.0000000 0.5503279</span></span>
<span><span class="co">## [4,] 1953 0.47890710        NA 1000.0000000 0.6146448</span></span>
<span><span class="co">## [5,] 1954 0.40245902        NA    0.6093443 0.4449180</span></span>
<span><span class="co">## [6,] 1955 0.04765027 0.4463934    0.6180874 0.3305464</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">trends_summary</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       year         a         b         c  d</span></span>
<span><span class="co">## [45,] 1994 0.3276503 0.5717486 0.1508743 NA</span></span>
<span><span class="co">## [46,] 1995 0.5151913 0.4853552 0.6555738 NA</span></span>
<span><span class="co">## [47,] 1996 0.4673224 0.4795628 0.4220765 NA</span></span>
<span><span class="co">## [48,] 1997 0.3340984 0.6895628 0.7624590 NA</span></span>
<span><span class="co">## [49,] 1998 0.6545355 0.1724044 0.3939891 NA</span></span>
<span><span class="co">## [50,] 1999 0.5532787 0.3660656 0.7278142 NA</span></span></code></pre>
<p>Now that I have ‘messed up’ the data a bit we have two species with
data missing at the beginning and one species with data missing at the
end. We also have one species with some very high values.</p>
<p>Now lets run this through the re-scaling function.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's run this data through our scaling function (all defaults used)</span></span>
<span><span class="va">rescaled_trends</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rescale_species.html">rescale_species</a></span><span class="op">(</span>Data <span class="op">=</span> <span class="va">trends_summary</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Here's the result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rescaled_trends</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'year'</span>, <span class="st">'indicator'</span>, <span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      year indicator         a        b          c         d</span></span>
<span><span class="co">## [1,] 1950 100.00000        NA       NA   100.0000 100.00000</span></span>
<span><span class="co">## [2,] 1951 113.66130        NA       NA 10000.0000  76.33433</span></span>
<span><span class="co">## [3,] 1952 124.43795        NA       NA 10000.0000  75.49475</span></span>
<span><span class="co">## [4,] 1953 112.24009 112.24009       NA 10000.0000  84.31784</span></span>
<span><span class="co">## [5,] 1954  92.53638  94.32317       NA   111.8904  61.03448</span></span>
<span><span class="co">## [6,] 1955  94.92278  11.16766 94.92278   113.4959  45.34483</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">rescaled_trends</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'year'</span>, <span class="st">'indicator'</span>, <span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       year indicator         a         b         c        d</span></span>
<span><span class="co">## [45,] 1994  94.69719  76.79046 121.57878  27.70419 96.72414</span></span>
<span><span class="co">## [46,] 1995 109.25300 120.74391 103.20775 120.37929 96.72414</span></span>
<span><span class="co">## [47,] 1996 103.80961 109.52502 101.97604  77.50351 96.72414</span></span>
<span><span class="co">## [48,] 1997 110.66363  78.30168 146.63123 140.00602 96.72414</span></span>
<span><span class="co">## [49,] 1998  93.88742 153.40162  36.66071  72.34598 96.72414</span></span>
<span><span class="co">## [50,] 1999 100.38848 129.67035  77.84156 133.64439 96.72414</span></span></code></pre>
<p>You can see that species ‘a’ and ‘b’ enter the dataset at the
geometric mean (the indicator value), all species are indexed at 100 in
the first year and the very high values in ‘c’ are capped at 10000 at
the end ‘d’ has been held at it’s end value.</p>
<p>The ‘indicator’ column that is returned here is our indicator,
calculated as the geometric mean of all the species in the data set.</p>
</div>
<div class="section level4">
<h4 id="confidence-intervals">Confidence intervals<a class="anchor" aria-label="anchor" href="#confidence-intervals"></a>
</h4>
<p>We can get confidence intervals for this indicator by bootstrapping
across species. We have a function for that too!</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This function takes just the species columns</span></span>
<span><span class="va">scaled_species</span> <span class="op">&lt;-</span> <span class="va">rescaled_trends</span><span class="op">[</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rescaled_trends</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'year'</span>, <span class="st">'indicator'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">indicator_CIs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap_indicator.html">bootstrap_indicator</a></span><span class="op">(</span>Data <span class="op">=</span> <span class="va">scaled_species</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   |                                                                              |                                                                      |   0%  |                                                                              |                                                                      |   1%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |==                                                                    |   4%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |=====                                                                 |   8%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |=======                                                               |  11%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |=========                                                             |  14%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  16%  |                                                                              |============                                                          |  17%  |                                                                              |============                                                          |  18%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |==============                                                        |  21%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  22%  |                                                                              |================                                                      |  23%  |                                                                              |================                                                      |  24%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |===================                                                   |  28%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |=======================                                               |  34%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |==========================                                            |  38%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  39%  |                                                                              |============================                                          |  40%  |                                                                              |============================                                          |  41%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |==============================                                        |  44%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |=================================                                     |  48%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |===================================                                   |  51%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |=====================================                                 |  54%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  56%  |                                                                              |========================================                              |  57%  |                                                                              |========================================                              |  58%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |==========================================                            |  61%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  62%  |                                                                              |============================================                          |  63%  |                                                                              |============================================                          |  64%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |===============================================                       |  68%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |=================================================                     |  71%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |===================================================                   |  74%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  76%  |                                                                              |======================================================                |  77%  |                                                                              |======================================================                |  78%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |==========================================================            |  84%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |=============================================================         |  88%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |===============================================================       |  91%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |=================================================================     |  94%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |====================================================================  |  98%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================|  99%  |                                                                              |======================================================================| 100%</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Returned are the CIs for our indicator</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">indicator_CIs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      quant_025 quant_975</span></span>
<span><span class="co">## [1,] 100.00000  100.0000</span></span>
<span><span class="co">## [2,]  79.51664  185.3712</span></span>
<span><span class="co">## [3,]  92.57867  197.7989</span></span>
<span><span class="co">## [4,]  71.91175  186.9973</span></span>
<span><span class="co">## [5,]  76.48790  111.0772</span></span>
<span><span class="co">## [6,]  74.68679  116.8558</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="smoothing">Smoothing<a class="anchor" aria-label="anchor" href="#smoothing"></a>
</h4>
<p>It is sometimes desirable to create a smoothed indicator value from
the raw values. This can be achieved by fitting a GAM (general additive
model) to the indicator using a spline. This spline is a smoothed curve
that goes through the raw values for the indicator and is fitted using
the function ‘gam’ in the ‘mgcv’ R package.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The smoothing function takes the indicator values</span></span>
<span><span class="va">smoothed_indicator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GAM_smoothing.html">GAM_smoothing</a></span><span class="op">(</span><span class="va">rescaled_trends</span><span class="op">[</span>,<span class="st">'indicator'</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In this example there is little support for a non-linear trend and </span></span>
<span><span class="co"># so the line almost linear</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rescaled_trends</span><span class="op">[</span>,<span class="st">'year'</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">rescaled_trends</span><span class="op">[</span>,<span class="st">'indicator'</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rescaled_trends</span><span class="op">[</span>,<span class="st">'year'</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">smoothed_indicator</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/smoothing_indicator-1.png" width="700"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># But if our indicator did support a non-linear trend it might look </span></span>
<span><span class="co"># like this</span></span>
<span><span class="va">eg_indicator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/jitter.html" class="external-link">jitter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span>, amount <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">eg_smoothed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GAM_smoothing.html">GAM_smoothing</a></span><span class="op">(</span><span class="va">eg_indicator</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, y <span class="op">=</span> <span class="va">eg_indicator</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, y <span class="op">=</span> <span class="va">eg_smoothed</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/smoothing_indicator-2.png" width="700"></p>
<p>Where there is little support for a non-linear trend a GAM smoothed
line will tend towards linear. Where there is good support for a
non-linear trend the smoothed line will become more ‘bendy’.</p>
</div>
<div class="section level4">
<h4 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h4>
<p>We now have our indicator and the confidence intervals around it. The
next step is to plot it. We have included a function that creates a
simple plot using ggplot2, however you could easily create your own
plots in R using the data.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot our indicator.</span></span>
<span><span class="fu"><a href="../reference/plot_indicator.html">plot_indicator</a></span><span class="op">(</span>indicator <span class="op">=</span> <span class="va">rescaled_trends</span><span class="op">[</span>,<span class="st">'indicator'</span><span class="op">]</span>,</span>
<span>               smoothed_line <span class="op">=</span> <span class="va">smoothed_indicator</span>,</span>
<span>               CIs <span class="op">=</span> <span class="va">indicator_CIs</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/plot_indicator-1.png" width="700"></p>
<p>In this plot you can see the high upper confidence interval in years
2-4, this is due to the artificially high values we gave to species
‘c’.</p>
</div>
</div>
<div class="section level3">
<h3 id="bayesian-meta-analysis-bma">Bayesian Meta-Analysis (BMA)<a class="anchor" aria-label="anchor" href="#bayesian-meta-analysis-bma"></a>
</h3>
<p>The Bayesian Meta-Analysis method, or BMA, is suited to data with
standard errors associated with them. As with other methods we require
data from more than one species, across a number of years, with an error
for each species-year estimate.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here is an example dataset for the BMA method</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span>, each <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>                   year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                   index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">50</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                   se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">50</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span>, min <span class="op">=</span> <span class="fl">0.01</span>, max <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   species year     index         se</span></span>
<span><span class="co">## 1       a    1 0.4783269 0.02657337</span></span>
<span><span class="co">## 2       a    2 0.4443901 0.08308297</span></span>
<span><span class="co">## 3       a    3 0.9653410 0.07088607</span></span>
<span><span class="co">## 4       a    4 0.2612954 0.06101668</span></span>
<span><span class="co">## 5       a    5 0.7607192 0.04758781</span></span>
<span><span class="co">## 6       a    6 0.7500249 0.01699128</span></span></code></pre>
<p>It is important that your data is in the same format and that your
columns are in the same order and have the same names. Remember you can
use the function <code><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv()</a></code> to read in the data from a .csv
on your computer.</p>
<p>BMA is run using the function <code>bma</code>, here we will use the
default settings and then see what we can change.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bma_indicator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bma.html">bma</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Warning: No negative index values detected. Are you sure you transformed the data?"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Processing function input....... </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Done. </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Compiling model graph</span></span>
<span><span class="co">##    Resolving undeclared variables</span></span>
<span><span class="co">##    Allocating nodes</span></span>
<span><span class="co">## Graph information:</span></span>
<span><span class="co">##    Observed stochastic nodes: 1274</span></span>
<span><span class="co">##    Unobserved stochastic nodes: 1291</span></span>
<span><span class="co">##    Total graph size: 8158</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Initializing model</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Adaptive phase..... </span></span>
<span><span class="co">## Adaptive phase complete </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Burn-in phase, 5000 iterations x 3 chains </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Sampling from joint posterior, 5000 iterations x 3 chains </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Calculating statistics....... </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Done.</span></span></code></pre>
<p><img src="vignette_files/figure-html/runBMA-1.png" width="700"></p>
<p>The function returns a plot to your screen which is a diagnostic plot
of the model. When the model has converged (i.e. reached a point where
the three chains agree on the answer) the lines on the plots on the left
will sit on top of one another and the plots on the right will have a
nice bell shape. You can turn off this plot by setting <code>plot</code>
to <code>FALSE</code>. By default the method runs the chains in series.
Running them in parallel makes the models run faster (about half the
time) but will slow down your computer more. We can change this with the
parameter <code>parallel</code>. The number of iterations the model runs
is controlled by <code>n.iter</code> and defaults to 10000. If you can
it is better to run it for more iterations, though this will take
longer. <code>m.scale</code> gives the scale your data is on. It is very
important that this is correct, choose from ‘loge’ (natural log,
sometimes simply called ‘log’), ‘log10’ (log to the base 10), or ‘logit’
(output from models of proportions or probabilities).</p>
<p>Let’s implement a few of these changes</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bma_indicator2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bma.html">bma</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>                     parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     n.iter <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                     m.scale <span class="op">=</span> <span class="st">'log10'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Warning: No negative index values detected. Are you sure you transformed the data?"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Processing function input....... </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Done. </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Beginning parallel processing using 11 cores. Console output will be suppressed.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parallel processing completed.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Calculating statistics....... </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Done.</span></span></code></pre>
<p><img src="vignette_files/figure-html/runBMAparameters-1.png" width="700"></p>
<p>Because we have reduced the number of interations the model no longer
has a good convergence. The lines on the graphs on the left do not
overlap and the graphs on the right are no longer a smooth bell
shape.</p>
<p>The object that is returned is a data.frame with years as rows and
columns giving the year value, index value and confidence intervals. You
can write this to a csv using the function <code>write.csv</code>.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bma_indicator</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Year Index.Mprime lowerCI.Mprime upperCI.Mprime   Index.M lowerCI.M upperCI.M</span></span>
<span><span class="co">## 1    1    100.00000      100.00000       100.0000 100.00000 100.00000  100.0000</span></span>
<span><span class="co">## 2    2     99.28257       96.55888       101.9275  99.36687  96.95978  101.7398</span></span>
<span><span class="co">## 3    3     98.70232       94.93140       102.6840  98.96504  94.93866  103.0453</span></span>
<span><span class="co">## 4    4     98.33416       93.95436       102.8283  98.76247  93.68349  104.0300</span></span>
<span><span class="co">## 5    5     98.37354       93.83166       103.2512  98.72980  92.84002  104.7310</span></span>
<span><span class="co">## 6    6     98.82353       94.46779       103.5405  98.83989  92.47682  105.3083</span></span></code></pre>
<p>We can use the plotting function in BRCindicators to plot the results
of this analysis, which in this case are not all that interesting!</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_indicator.html">plot_indicator</a></span><span class="op">(</span>indicator <span class="op">=</span> <span class="va">bma_indicator</span><span class="op">[</span>,<span class="st">'Index.M'</span><span class="op">]</span>,</span>
<span>               CIs <span class="op">=</span> <span class="va">bma_indicator</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/BMAplot-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="multi-species-indicator">Multi-species Indicator<a class="anchor" aria-label="anchor" href="#multi-species-indicator"></a>
</h3>
<p>The multi-species indicator method was developed by Statistics
Netherlands and the code is made available on <a href="https://www.cbs.nl/en-gb/society/nature-and-environment/indices-and-trends--trim--/msi-tool" class="external-link">their
website</a>. To find out more about the inner working of this method
please read the <a href="https://www.cbs.nl/-/media/_pdf/2017/22/msi_manual.pdf" class="external-link">detailed
documentation</a> on the authors website. Here is a simple example of
how this method runs in <code>BRCindicators</code>.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create some example data in the format required</span></span>
<span><span class="va">nyr</span> <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="va">species</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span>, each <span class="op">=</span> <span class="va">nyr</span><span class="op">)</span></span>
<span><span class="va">year</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nyr</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create an index value that increases with time</span></span>
<span><span class="va">index</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">100</span>, length.out <span class="op">=</span> <span class="va">nyr</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Add randomness to species</span></span>
<span><span class="va">index</span> <span class="op">=</span> <span class="va">index</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span>, <span class="fl">0.7</span>, <span class="fl">1.3</span><span class="op">)</span></span>
<span><span class="co"># Add correlated randomness across species, to years</span></span>
<span><span class="va">index</span> <span class="op">=</span> <span class="va">index</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1.2</span>, n <span class="op">=</span> <span class="va">nyr</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">se</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nyr</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span>, min <span class="op">=</span> <span class="fl">10</span>, max <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">year</span>, <span class="va">index</span>, <span class="va">se</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Our species are decreasing</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">year</span>, <span class="va">data</span><span class="op">$</span><span class="va">index</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/msi1-1.png" width="700"></p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Species index values need to be 100 in the base year. Here I use</span></span>
<span><span class="co"># the first year as my base year and rescale to 100. The standard error</span></span>
<span><span class="co"># in the base year should be 0.</span></span>
<span><span class="va">min_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">sp</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">subset_data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">species</span> <span class="op">==</span> <span class="va">sp</span>, <span class="op">]</span></span>
<span>  <span class="va">multi_factor</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">/</span> <span class="va">subset_data</span><span class="op">$</span><span class="va">index</span><span class="op">[</span><span class="va">subset_data</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="va">min_year</span><span class="op">]</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">index</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">species</span> <span class="op">==</span> <span class="va">sp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">index</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">species</span> <span class="op">==</span> <span class="va">sp</span><span class="op">]</span> <span class="op">*</span> <span class="va">multi_factor</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">se</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">species</span> <span class="op">==</span> <span class="va">sp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">se</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">species</span> <span class="op">==</span> <span class="va">sp</span><span class="op">]</span> <span class="op">*</span> <span class="va">multi_factor</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">se</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">species</span> <span class="op">==</span> <span class="va">sp</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Our first year is now indexed at 100</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">year</span>, <span class="va">data</span><span class="op">$</span><span class="va">index</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/msi1-2.png" width="700"></p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Alternativly I could read in data from a csv</span></span>
<span><span class="co"># data &lt;- read.csv('path/to/my/data.csv')</span></span>
<span></span>
<span><span class="co"># Run the MSI function</span></span>
<span><span class="va">msi_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msi.html">msi</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/msi1-3.png" width="700"><img src="vignette_files/figure-html/msi1-4.png" width="700"></p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">msi_out</span><span class="op">$</span><span class="va">CV</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   species   mean_CV</span></span>
<span><span class="co">## 1       a 0.2073205</span></span>
<span><span class="co">## 2       b 0.2097742</span></span>
<span><span class="co">## 3       c 0.2327759</span></span>
<span><span class="co">## 4       d 0.2181222</span></span>
<span><span class="co">## 5       e 0.2148589</span></span>
<span><span class="co">## 6       f 0.2171923</span></span></code></pre>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># I can capture the output figures too</span></span>
<span><span class="co"># pdf('test.pdf')</span></span>
<span><span class="co">#   msi_out &lt;- msi(data)</span></span>
<span><span class="co"># dev.off()</span></span></code></pre></div>
<p>The code returns two plots to the console, the first plot shows the
coefficient of variation (CV) for each of the species. Species with high
values of CV may adversly effect the relaibility of the trend
estimation. Use this graph to identify the CV values of the species and
use the <code>maxCV</code> parameter to set a threshold above which
species will be excluded. The results of excluding species in this way
can be tested by comparing trend plots. The CV values are hard to assign
to species from this plot as the species are coded to numbers. To see
the raw values look at the CV component of msi_out
(i.e. <code>msi_out$CV</code>). The second plot shows the smoothed trend
and the MSI values. These two figures can be captured in the usual way
in R by using <code><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf()</a></code> for example. In the example I create a
dataset from random numbers but usually you would use
<code><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv()</a></code> to read in data from a local file.</p>
<p>Here is a second example which sets some additional parameters. The
parameters for <code>msi</code> get passed to <code>msi_tool</code> so
to see a list of all the parameters you can change look at the help
documentation in <code>msi_tool</code> usign <code><a href="../reference/msi_tool.html">?msi_tool</a></code> at
the R console. I cover most of hte important ones here.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">msi_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msi.html">msi</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>               nsim <span class="op">=</span> <span class="fl">500</span>, <span class="co"># The number of Mote Carlo simulations</span></span>
<span>               SEbaseyear <span class="op">=</span> <span class="fl">10</span>, <span class="co"># The year to index on</span></span>
<span>               plotbaseyear <span class="op">=</span> <span class="fl">15</span>, <span class="co"># The year to set as 100 in plots</span></span>
<span>               index_smoot <span class="op">=</span> <span class="st">'INDEX'</span>, <span class="co"># plotbaseyear uses MSI not trend</span></span>
<span>               span <span class="op">=</span> <span class="fl">0.7</span>, <span class="co"># 'wigglyness' of line, between 0 and 1</span></span>
<span>               lastyears <span class="op">=</span> <span class="fl">5</span>, <span class="co"># last X years of time series for short-term trends</span></span>
<span>               maxCV <span class="op">=</span> <span class="fl">10</span>, <span class="co"># maximum allowed Coefficient of Variation </span></span>
<span>               changepoint <span class="op">=</span> <span class="fl">10</span>, <span class="co"># compare trends before and after this year</span></span>
<span>               truncfac <span class="op">=</span> <span class="fl">8</span>, <span class="co"># max year-to-year index ratio</span></span>
<span>               TRUNC <span class="op">=</span> <span class="fl">5</span>, <span class="co">#set all indices below TRUNC to this</span></span>
<span>               plot <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># should the plots be returned?)</span></span>
<span>               <span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/msi2-1.png" width="700"><img src="vignette_files/figure-html/msi2-2.png" width="700"></p>
<p>This set of parameters is unrealistic but shows the options
available. Note that in the second graph the year 10 point now has a se
= 0, year 15 MSI is set to 100, and the short term trend is reported for
the last 5 years.</p>
<p>The analysis also returns data which provide more insights into the
analysis and let you create your own plots if required.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The returned object has 2 elements</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">msi_out</span><span class="op">$</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   year    MSI sd_MSI lower_CL_MSI upper_CL_MSI  Trend lower_CL_trend</span></span>
<span><span class="co">## 1    1 174.55   8.59       158.52       192.22 165.98         153.83</span></span>
<span><span class="co">## 2    2 160.34   7.87       145.63       176.55 172.92         164.98</span></span>
<span><span class="co">## 3    3 189.88   9.07       172.92       208.52 177.94         171.72</span></span>
<span><span class="co">## 4    4 169.84   9.00       153.08       188.44 180.72         173.44</span></span>
<span><span class="co">## 5    5 164.29   9.15       147.30       183.24 180.97         173.44</span></span>
<span><span class="co">## 6    6 198.95   9.07       181.95       217.54 179.10         171.72</span></span>
<span><span class="co">##   upper_CL_trend      trend_class</span></span>
<span><span class="co">## 1         178.73 moderate_decline</span></span>
<span><span class="co">## 2         182.34 moderate_decline</span></span>
<span><span class="co">## 3         184.17 moderate_decline</span></span>
<span><span class="co">## 4         187.89 moderate_decline</span></span>
<span><span class="co">## 5         187.89 moderate_decline</span></span>
<span><span class="co">## 6         187.89 moderate_decline</span></span></code></pre>
<p>The first of the two elements (<code>results</code>) returned gives
all the data, and a little more, that is presented in the second
figure.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The returned object has 2 elements</span></span>
<span><span class="va">msi_out</span><span class="op">$</span><span class="va">trends</span></span></code></pre></div>
<pre><code><span><span class="co">##                             Measure    value     significance</span></span>
<span><span class="co">## 1                     overall trend   0.9633 moderate decline</span></span>
<span><span class="co">## 2                  SE overall trend   0.0021                 </span></span>
<span><span class="co">## 3                trend last 5 years   0.9359 moderate decline</span></span>
<span><span class="co">## 4             SE trend last 5 years   0.0166                 </span></span>
<span><span class="co">## 5                  changepoint (10)  10.0000                 </span></span>
<span><span class="co">## 6     trend before changepoint (10)   0.9891 moderate decline</span></span>
<span><span class="co">## 7  SE trend before changepoint (10)   0.0048                 </span></span>
<span><span class="co">## 8      trend after changepoint (10)   0.9621 moderate decline</span></span>
<span><span class="co">## 9   SE trend after changepoint (10)   0.0045                 </span></span>
<span><span class="co">## 10                         % change -43.3920           p&lt;0.01</span></span>
<span><span class="co">## 11                      SE % change   3.0630                 </span></span>
<span><span class="co">## 12            % change last 5 years  -9.6510           p&lt;0.01</span></span>
<span><span class="co">## 13         SE % change last 5 years   2.5580                 </span></span>
<span><span class="co">## 14                      changepoint       NA           p&lt;0.01</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># I could write this as a csv too</span></span>
<span><span class="co"># write.csv(msi_out$trends, file = 'path/to/my/output.csv')</span></span></code></pre></div>
<p>The second element (<code>trends</code>) returned give a summary of
various trend assessments across the time series.</p>
<p>We have also added a plot method for the MSI output which provides a
plot similar to that of the second figure we have seen already. Lets use
this plot method to explore the effect of changing the span value in the
analysis</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co"># use a range of values for span</span></span>
<span>  </span>
<span>  <span class="va">msi_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msi.html">msi</a></span><span class="op">(</span><span class="va">data</span>, span <span class="op">=</span> <span class="va">i</span>, <span class="co"># span is set to i</span></span>
<span>                 nsim <span class="op">=</span> <span class="fl">200</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="co"># print makes the plot visible in the for loop</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">msi_out</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'MSI - span ='</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span> <span class="co"># plot</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/msi_span-1.png" width="700"><img src="vignette_files/figure-html/msi_span-2.png" width="700"><img src="vignette_files/figure-html/msi_span-3.png" width="700"></p>
<p>As the value of span gets closer to 1 the trend line gets
smoother.</p>
</div>
<div class="section level3">
<h3 id="lambda-indicator">Lambda Indicator<a class="anchor" aria-label="anchor" href="#lambda-indicator"></a>
</h3>
<p>The lambda indicator calculates an indicator using growth rates from
one year to the next. Formulating the indicator in terms of growth rates
has two distinct advantages over the conventional approach to
constructing indicators. First, it means that the categorisation of
species as ‘increasing’ or ‘decreasing’ can be made from the same set of
data (the growth rates) as the construction of the indicator. Second, it
provides an elegant solution to the problem of species that join the
indicator after the first year (i.e. where the first year is
unreliable): other indicators typically adopt a complicated rescaling
approach to ensure that species entering the indicator after the first
year do not bias the overall assessment. It also makes a simple and
robust, though untestable, assumption about species that drop out of the
indicator prior to the final year: specifically it assumes that their
fluctuations are the same, in aggregate, as those of the species that
remain in the indicator. For more details see <a href="http://webarchive.nationalarchives.gov.uk/20170302170037/http://jncc.defra.gov.uk/Docs/UKBI2015_TechBG_C4b-D1c_Bayesian_Final.docx" class="external-link uri">http://webarchive.nationalarchives.gov.uk/20170302170037/http://jncc.defra.gov.uk/Docs/UKBI2015_TechBG_C4b-D1c_Bayesian_Final.docx</a></p>
<p>Very few species’ models produced reliable occupancy estimates for
every year, so a majority of the time series contain missing values.
This presents a problem for estimating growth rates for each
species-year combination. Missing values of growth rate that would be
equivalent to linear interpolation of the log odds between adjacent
years with reliable estimates were therefore calculated. This indicator
can therefore work with missing values.</p>
<p>Input data is on the occupancy scale, and is therefore bounded
between 0 and 1.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of species</span></span>
<span><span class="va">nsp</span> <span class="op">=</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co"># number of years</span></span>
<span><span class="va">nyr</span> <span class="op">=</span> <span class="fl">40</span></span>
<span></span>
<span><span class="co">#number of iterations</span></span>
<span><span class="va">iter</span> <span class="op">=</span> <span class="fl">500</span></span>
<span></span>
<span><span class="co"># Build a random set of data</span></span>
<span><span class="va">myArray</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nsp</span><span class="op">*</span><span class="va">nyr</span><span class="op">*</span><span class="va">iter</span>,</span>
<span>                               mean <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                               sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nsp</span>, <span class="va">nyr</span>, <span class="va">iter</span><span class="op">)</span>,</span>
<span>                  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'SP'</span>,<span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span>,</span>
<span>                                  <span class="fl">1</span><span class="op">:</span><span class="va">nyr</span>,</span>
<span>                                  <span class="fl">1</span><span class="op">:</span><span class="va">iter</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ensure values are bounded by 0 and 1</span></span>
<span><span class="va">myArray</span><span class="op">[</span><span class="va">myArray</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">myArray</span><span class="op">[</span><span class="va">myArray</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">myArray</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  num [1:50, 1:40, 1:500] 0.501 0.44 0.454 0.309 0.307 ...</span></span>
<span><span class="co">##  - attr(*, "dimnames")=List of 3</span></span>
<span><span class="co">##   ..$ : chr [1:50] "SP1" "SP2" "SP3" "SP4" ...</span></span>
<span><span class="co">##   ..$ : chr [1:40] "1" "2" "3" "4" ...</span></span>
<span><span class="co">##   ..$ : chr [1:500] "1" "2" "3" "4" ...</span></span></code></pre>
<p><code>lambda_indicator</code> takes in an array of data, a
three-dimensional matrix. The dimensions of this array represent
species, years, and iterations. Each row represents a species and each
column a year. The third dimension of the array contains the iterations.
Essentially each slice contains occupancy estimates for each species
year combination for a single iteration and the overall array contains
as many slices as there are iterations.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the lambda_interpolation method on this data</span></span>
<span><span class="va">myIndicator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lambda_indicator.html">lambda_indicator</a></span><span class="op">(</span><span class="va">myArray</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the indicator</span></span>
<span><span class="fu"><a href="../reference/plot_indicator.html">plot_indicator</a></span><span class="op">(</span><span class="va">myIndicator</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span>,<span class="st">'indicator'</span><span class="op">]</span>,</span>
<span>               <span class="va">myIndicator</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lower'</span> ,<span class="st">'upper'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/lambda_2-1.png" width="700"></p>
<p>There are a number of options available in the
<code>lambda_indicator</code> function</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myIndicator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lambda_indicator.html">lambda_indicator</a></span><span class="op">(</span><span class="va">myArray</span>,</span>
<span>                                index <span class="op">=</span> <span class="fl">1</span>, <span class="co"># Set the index value to 1 not 100</span></span>
<span>                                year_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>,<span class="fl">40</span><span class="op">)</span>, <span class="co"># Set year range</span></span>
<span>                                threshold_yrs <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># set a threshold</span></span>
<span><span class="fu"><a href="../reference/plot_indicator.html">plot_indicator</a></span><span class="op">(</span><span class="va">myIndicator</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span>,<span class="st">'indicator'</span><span class="op">]</span>,</span>
<span>               <span class="va">myIndicator</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lower'</span> ,<span class="st">'upper'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/lambda_3-1.png" width="700"></p>
<p>Note that there are a range of threshold functions that allow you to
adjust which data points are used in the indicator. There are options to
remove species year estimates based on their standard deviaction, Rhat
value and based on the number of years a species is present in the
dataset. Note that the Rhat threshold can only be used if you are using
a directory path as you input rather than an array.</p>
</div>
</div>
<div class="section level2">
<h2 id="creating-a-custom-pipeline-function">Creating a custom pipeline function<a class="anchor" aria-label="anchor" href="#creating-a-custom-pipeline-function"></a>
</h2>
<p>We have demonstrated how you might run the indicator functions one at
a time, however in a ‘pipeline’ we want data to flow through seamlessly.
Additionally there are a number of parameters in the functions that we
have not shown you that you might find useful. Here is an example of how
you can create your own pipeline function. Our function will wrap around
the functions described above, setting the parameters to meet our needs.
Once we have done this it will allow use to execute our pipeline in one
line.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># I call my function 'run_pipeline' and the only arguement it</span></span>
<span><span class="co"># takes is the directory of sparta's output</span></span>
<span><span class="va">run_pipeline</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_dir</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BiologicalRecordsCentre/sparta" class="external-link">sparta</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BiologicalRecordsCentre/BRCindicators" class="external-link">BRCindicators</a></span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Create the trends summary</span></span>
<span>  <span class="va">trends_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarise_occDet.html">summarise_occDet</a></span><span class="op">(</span>input_dir <span class="op">=</span> <span class="va">input_dir</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Rescale the values and get the indicator values</span></span>
<span>  <span class="co"># Here I set the index to 1 and change the value limits</span></span>
<span>  <span class="va">rescaled_trends</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rescale_species.html">rescale_species</a></span><span class="op">(</span>Data <span class="op">=</span> <span class="va">trends_summary</span>,</span>
<span>                                     index <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                     max <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                     min <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Bootstrap the indicator to get CIs</span></span>
<span>  <span class="va">scaled_species</span> <span class="op">&lt;-</span> <span class="va">rescaled_trends</span><span class="op">[</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rescaled_trends</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'year'</span>, <span class="st">'indicator'</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="co"># This time I set the iterations to twice the default and </span></span>
<span>  <span class="co"># use custom confidence intervals</span></span>
<span>  <span class="va">indicator_CIs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap_indicator.html">bootstrap_indicator</a></span><span class="op">(</span>Data <span class="op">=</span> <span class="va">scaled_species</span>,</span>
<span>                                       CI_limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span>,</span>
<span>                                       iterations <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Get the smoothed indicator line</span></span>
<span>  <span class="va">smoothed_indicator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GAM_smoothing.html">GAM_smoothing</a></span><span class="op">(</span><span class="va">rescaled_trends</span><span class="op">[</span>,<span class="st">'indicator'</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># This time I specify the years and index value</span></span>
<span>  <span class="fu"><a href="../reference/plot_indicator.html">plot_indicator</a></span><span class="op">(</span>indicator <span class="op">=</span> <span class="va">rescaled_trends</span><span class="op">[</span>,<span class="st">'indicator'</span><span class="op">]</span>,</span>
<span>                 year <span class="op">=</span> <span class="va">rescaled_trends</span><span class="op">[</span>,<span class="st">'year'</span><span class="op">]</span>,</span>
<span>                 index <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                 CIs <span class="op">=</span> <span class="va">indicator_CIs</span>,</span>
<span>                 smoothed_line <span class="op">=</span> <span class="va">smoothed_indicator</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## I'll return all my data  </span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">smoothed_indicator</span>, <span class="va">indicator_CIs</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">trends_summary</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="op">}</span></span></code></pre></div>
<p>Once we have created this function we can run this pipeline on a
directory in one line, or put it in a loop to run across many
directories.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now we can run the pipeline in one line, like a boss</span></span>
<span><span class="va">indicator_data</span> <span class="op">&lt;-</span> <span class="fu">run_pipeline</span><span class="op">(</span>input_dir <span class="op">=</span> <span class="st">'~/Testing_indicator_pipe'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading data...done</span></span>
<span><span class="co">##   |                                                                              |                                                                      |   0%  |                                                                              |                                                                      |   1%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |==                                                                    |   4%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |=====                                                                 |   8%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |=======                                                               |  11%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |=========                                                             |  14%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  16%  |                                                                              |============                                                          |  17%  |                                                                              |============                                                          |  18%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |==============                                                        |  21%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  22%  |                                                                              |================                                                      |  23%  |                                                                              |================                                                      |  24%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |===================                                                   |  28%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |=======================                                               |  34%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |==========================                                            |  38%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  39%  |                                                                              |============================                                          |  40%  |                                                                              |============================                                          |  41%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |==============================                                        |  44%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |=================================                                     |  48%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |===================================                                   |  51%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |=====================================                                 |  54%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  56%  |                                                                              |========================================                              |  57%  |                                                                              |========================================                              |  58%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |==========================================                            |  61%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  62%  |                                                                              |============================================                          |  63%  |                                                                              |============================================                          |  64%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |===============================================                       |  68%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |=================================================                     |  71%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |===================================================                   |  74%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  76%  |                                                                              |======================================================                |  77%  |                                                                              |======================================================                |  78%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |==========================================================            |  84%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |=============================================================         |  88%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |===============================================================       |  91%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |=================================================================     |  94%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |====================================================================  |  98%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================|  99%  |                                                                              |======================================================================| 100%</span></span></code></pre>
<p><img src="vignette_files/figure-html/in_one-1.png" width="700"></p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">indicator_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   smoothed_indicator  quant_25  quant_75 year          a         b         c</span></span>
<span><span class="co">## 1          0.9176004 1.0000000 1.0000000 1950 0.71950820 0.7444262 0.5445902</span></span>
<span><span class="co">## 2          0.9180913 0.8852408 1.0106197 1951 0.64792350 0.7115847 0.6653552</span></span>
<span><span class="co">## 3          0.9185822 0.9424826 1.0381675 1952 0.61234973 0.6830055 0.2850820</span></span>
<span><span class="co">## 4          0.9190731 0.8238429 1.0059378 1953 0.47890710 0.4786339 0.5400546</span></span>
<span><span class="co">## 5          0.9195640 0.8421503 0.9556367 1954 0.40245902 0.5300546 0.6093443</span></span>
<span><span class="co">## 6          0.9200549 0.8428048 1.0049734 1955 0.04765027 0.4463934 0.6180874</span></span>
<span><span class="co">##           d         e         f         g          h         i         j</span></span>
<span><span class="co">## 1 0.7289617 0.5140437 0.5191257 0.6771585 0.77109290 0.3362842 0.6269399</span></span>
<span><span class="co">## 2 0.5564481 0.4214208 0.6875956 0.6949180 0.15005464 0.5807104 0.6743716</span></span>
<span><span class="co">## 3 0.5503279 0.4503825 0.4346995 0.8420765 0.75590164 0.7197268 0.4124590</span></span>
<span><span class="co">## 4 0.6146448 0.4059563 0.7480874 0.4806557 0.02382514 0.8195082 0.7612022</span></span>
<span><span class="co">## 5 0.4449180 0.8789071 0.8591257 0.3380874 0.49256831 0.4837705 0.6448634</span></span>
<span><span class="co">## 6 0.3305464 0.8898907 0.6350820 0.8497814 0.81546448 0.1274863 0.5738251</span></span>
<span><span class="co">##           k         l         m         n         o         p         q</span></span>
<span><span class="co">## 1 0.6919126 0.7751366 0.4428415 0.9062295 0.5555191 0.3422404 0.8508743</span></span>
<span><span class="co">## 2 0.3614754 0.7466667 0.7452459 0.8836066 0.9113661 0.7820219 0.3772131</span></span>
<span><span class="co">## 3 0.8724590 0.6345902 0.6355191 0.6290710 0.7693443 0.6283607 0.8969399</span></span>
<span><span class="co">## 4 0.6209836 0.6358470 0.8611475 0.9265027 0.7610929 0.4493989 0.9014754</span></span>
<span><span class="co">## 5 0.3384153 0.7289617 0.5253552 0.7102186 0.9492896 0.7979781 0.8237158</span></span>
<span><span class="co">## 6 0.5411475 0.7955191 0.8191257 0.8801639 0.9270492 0.9244262 0.6891803</span></span>
<span><span class="co">##           r         s         t         u         v         w         x</span></span>
<span><span class="co">## 1 0.3624590 0.8491257 0.9315847 0.8820765 0.7602186 0.9207650 0.8680328</span></span>
<span><span class="co">## 2 0.7379235 0.6858470 0.4902732 0.9032240 0.6163388 0.8891803 0.7600546</span></span>
<span><span class="co">## 3 0.8562295 0.8755738 0.5028415 0.9459563 0.6913115 0.6890710 0.7570492</span></span>
<span><span class="co">## 4 0.6147541 0.8377049 0.9469945 0.7153552 0.9408743 0.7243169 0.8547541</span></span>
<span><span class="co">## 5 0.4848634 0.3191803 0.9298361 0.3034426 0.8632787 0.8720765 0.4791257</span></span>
<span><span class="co">## 6 0.6475410 0.8012568 0.6865574 0.9415301 0.8552459 0.7222404 0.8656284</span></span>
<span><span class="co">##           y         z</span></span>
<span><span class="co">## 1 0.8845355 0.9492350</span></span>
<span><span class="co">## 2 0.8683607 0.8152459</span></span>
<span><span class="co">## 3 0.8835519 0.8234973</span></span>
<span><span class="co">## 4 0.8295082 0.7040437</span></span>
<span><span class="co">## 5 0.9681421 0.8576503</span></span>
<span><span class="co">## 6 0.8666667 0.7646448</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dylan Carbone, Tom August, Gary Powney, Charlie Outhwaite, Jack Hatfield, Mark Logie, Stephen Freeman, Nick Isaac.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
