<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Use a Bayesian meta-analysis to create an indicator from species index values, optionally incorporating standard error."><title>Bayesian Meta-analysis — bma • BRCindicators</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian Meta-analysis — bma"><meta property="og:description" content="Use a Bayesian meta-analysis to create an indicator from species index values, optionally incorporating standard error."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BRCindicators</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.7</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette.html">BRCindicators</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/BiologicalRecordsCentre/BRCindicators/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Bayesian Meta-analysis</h1>
      <small class="dont-index">Source: <a href="https://github.com/BiologicalRecordsCentre/BRCindicators/blob/HEAD/R/bayesian_meta_analysis.R" class="external-link"><code>R/bayesian_meta_analysis.R</code></a></small>
      <div class="d-none name"><code>bma.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Use a Bayesian meta-analysis to create an indicator from species index values, optionally incorporating standard error.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bma</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"smooth"</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n.cores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  incl.model <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n.iter <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  n.thin <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  m.scale <span class="op">=</span> <span class="st">"loge"</span>,</span>
<span>  num.knots <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  seFromData <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  Y1perfect <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  rescale_indices <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rescaleYr <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  baseline <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  errorY1 <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  save.sppars <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  incl.2deriv <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  CI <span class="op">=</span> <span class="fl">95</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>a data.frame with 3-4 columns: `species`, `year`, `index`, `se` (standard error). The `se` column is optional 
NB: Index values are assumed to be on the unbounded (logarithmic scale)</p></dd>


<dt>plot</dt>
<dd><p>Logical, should a trace plot be plotted to diagnose the model output?</p></dd>


<dt>model</dt>
<dd><p>The type of model to be used. See details.</p></dd>


<dt>parallel</dt>
<dd><p>if <code>TRUE</code> the model chains will be run in parallel using one fewer cores than
are available on the computer as default. NOTE: this will typically not work for parallel use on cluster PCs.</p></dd>


<dt>n.cores</dt>
<dd><p>if running the code in parallel this option specifies the number of cores to use.</p></dd>


<dt>incl.model</dt>
<dd><p>if <code>TRUE</code> the model is added as an attribute of the object returned</p></dd>


<dt>n.iter</dt>
<dd><p>The number of iterations of the model to run. Defaults to 10,000 to avoid long run times
though much longer runs are usually required to reach convergence</p></dd>


<dt>n.thin</dt>
<dd><p>Thinning rate for the Markov chains. Defaults to 5.</p></dd>


<dt>m.scale</dt>
<dd><p>The measurement scale of the data. The scale of the data is assumed to be logarithmic.
Here you specify which log scale the data is on ('loge', 'log10', or 'logit'). Defaults to 'loge'.</p></dd>


<dt>num.knots</dt>
<dd><p>If using either of the smooth models this specifies the number of knots.</p></dd>


<dt>seFromData</dt>
<dd><p>Logical. Should the standard errors be read in from data (`TRUE`) or estimated (`FALSE`)?  Defaults to `FALSE`</p></dd>


<dt>Y1perfect</dt>
<dd><p>Logical. Should the first year of a species' index be assumed known without error (`TRUE`)? Defaults to `TRUE`</p></dd>


<dt>rescale_indices</dt>
<dd><p>Integer. A value for standardising each species time-series to start at a common value (e.g. 0). Defaults to NULL (i.e. no standardisation)</p></dd>


<dt>rescaleYr</dt>
<dd><p>Integer. To which year should the indicator use as a reference value (i.e. baseline). Values greater than the number of years in the dataset will be set to the final year. Defaults to 1 (the first year)</p></dd>


<dt>baseline</dt>
<dd><p>Integer. What is the value of the indicator in the baseline year (defaults to 100)</p></dd>


<dt>errorY1</dt>
<dd><p>Logical. Should the indicator be presented with (`TRUE`) or without (`FALSE`) uncertainty in the baseline year. Defaults to `FALSE`.</p></dd>


<dt>save.sppars</dt>
<dd><p>Logical. Should the species-specific parameters be monitored? Defaults to TRUE</p></dd>


<dt>incl.2deriv</dt>
<dd><p>Logical. Option to include estimation of second derivatives on the indicator (`TRUE`)? Defaults to `FALSE`</p></dd>


<dt>CI</dt>
<dd><p>defines the credible intervals of the posterior distribution to report. Defaults the 95th percentile</p></dd>


<dt>seed</dt>
<dd><p>Option to set a custom seed to initialize JAGS chains, for reproducibility. Should be an integer. This argument will be deprecated in the next version, but you can always set the outside the function yourself.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Returns a dataframe with 7 columns: Year, Index.Mprime, lowerCI.Mprime, upperCI.Mprime, Index.M, lowerCI.M and, upperCI.M. 
Columns headed `M` and `Mprime` are means of the M and M' parameters  as defined in Freeman et al (2020). The 'upper' and 'lower' columns are the credible intervals, the width of which is defined by the `CI` argument.
Note that M and M' are alternate ways of calculating the multispecies indicator: their means are nearly always virtually identical, but the uncertainty in M is usually much wider than in M'. See Freeman et al (2020) for more details.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>There are a number of model to choose from:</p><ul><li><p><code>"smooth"</code> The default option. Indicator defined by Growth rates, with Ruppert smoother, allowing for species to join late. Error on the first year of each species' time-series is assumed to be zero. The indicator is the expected value of the geometric mean across species (with missing species imputed). 
 Includes three options: `seFromData` `Y1perfect` and `incl.2deriv`. See bayesian_meta_analysis for mode details. Using the default values `seFromData = FALSE` and `Y1perfect = TRUE` are the options used in Freeman  <em>et al.</em> (2020).</p></li>
<li><p><code>"smooth_det2"</code> Equivalent to smooth with `seFromData = TRUE` and `Y1perfect = FALSE`. Retained for backwards compatability. Choosing this option will overwrite user-entered options for `seFromData` and `Y1perfect`.</p></li>
<li><p><code>"smooth_det_sigtheta"</code> Equivalent to smooth with `seFromData = FALSE` and `Y1perfect = FALSE`. Retained for backwards compatability. Choosing this option will overwrite user-entered options for `seFromData` and `Y1perfect`.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Freeman, S.N., Isaac, N.J.B., Besbeas, P.T., Dennis, E.B. &amp; Morgan, B.J.T. (2020) 
            A generic method for estimating and smoothing multispecies biodiversity indices, robust to intermittent data. 
            <em>Journal of Agricultural Biological and Environmental Statistics</em>, in revision.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Only run if there is a JAGS installation</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu">runjags</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/runjags/man/testjags.html" class="external-link">testjags</a></span><span class="op">(</span>silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">JAGS.found</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create some example data in the format required</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span>, each <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">50</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">50</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span>, min <span class="op">=</span> <span class="fl">0.01</span>, max <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run the Bayesian meta-analysis</span></span></span>
<span class="r-in"><span><span class="va">bma_indicator</span> <span class="op">&lt;-</span> <span class="fu">bma</span><span class="op">(</span><span class="va">data</span>, model<span class="op">=</span><span class="st">"smooth"</span>, m.scale<span class="op">=</span><span class="st">"logit"</span>, n.iter<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the resulting indicator</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_indicator.html">plot_indicator</a></span><span class="op">(</span>indicator <span class="op">=</span> <span class="va">bma_indicator</span><span class="op">[</span>,<span class="st">'Index.Mprime'</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>               CIs <span class="op">=</span> <span class="va">bma_indicator</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>   <span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dylan Carbone, Tom August, Gary Powney, Charlie Outhwaite, Jack Hatfield, Mark Logie, Stephen Freeman, Nick Isaac.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

